{% extends "layouts/base.html" %}

{% block title %}Create Quiz{% endblock %}

{% block content %}
  <div class="content">
    <div class="row">
      <div class="col-md-8">
        <div class="card">
          <div class="card-header">
            <h5 class="title">Generate Quiz Excel Template</h5>
          </div>
          <div class="card-body">
            <form method="POST">
              {% csrf_token %}
              <div class="form-group">
                <label for="num_questions">Number of Questions</label>
                <input type="number" id="num_questions" name="num_questions" class="form-control" min="1" required>
              </div>
              <button type="submit" class="btn btn-primary btn-fill">Generate Excel</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    {% if filename %}
      <div class="row">
        <div class="col-md-8">
          <div class="card">
            <div class="card-body">
              <h5>Your quiz file is ready!</h5>
              <!-- Form to trigger download -->
              <form method="GET" action="{% url 'download_quiz_file' %}">
                <input type="hidden" name="filename" value="{{ filename }}">
                <button type="submit" class="btn btn-success btn-fill">Download your file</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    {% endif %}
    
    <div class="row mt-4">
      <div class="col-md-8">
      <div class="card">
        <div class="card-header">
        <h5 class="title">Upload Quiz Excel File</h5>
        </div>
        <div class="card-body">
        <form method="POST" enctype="multipart/form-data">
          {% csrf_token %}
          <div class="form-group">
          <label for="quiz_file">Choose Excel File (.xlsx)</label>
          <div class="input-group mb-3">
            <div class="input-group-prepend">
            <span class="input-group-text">Upload</span>
            </div>
            <div class="custom-file">
            <input type="file" id="quiz_file" name="quiz_file" accept=".xlsx" class="custom-file-input" required onchange="updateFileName()">
            <label class="custom-file-label" for="quiz_file" id="file_label">Choose file</label>
            </div>
          </div>
          </div>
          <button type="submit" name="upload_excel" class="btn btn-info btn-fill">Upload Excel</button>
        </form>
        </div>
      </div>
      </div>
    </div>
    <div class="input-group mb-3">
      <div class="input-group-prepend">
        <span class="input-group-text">Upload</span>
      </div>
      <div class="custom-file">
        <input type="file" class="custom-file-input" id="inputGroupFile01">
        <label class="custom-file-label" for="inputGroupFile01">Choose file</label>
      </div>
    </div>
    <script>
      function updateFileName() {
      const fileInput = document.getElementById('quiz_file');
      const fileLabel = document.getElementById('file_label');
      if (fileInput.files.length > 0) {
        fileLabel.textContent = fileInput.files[0].name;
      } else {
        fileLabel.textContent = 'Choose file';
      }
      }
    </script>
    
    {% if upload_success %}
      <div class="row">
        <div class="col-md-8">
          <div class="card">
            <div class="card-body">
              <h5>âœ… File uploaded successfully!</h5>
              <p>Saved at: <code>{{ uploaded_path }}</code></p>
            </div>
          </div>
        </div>
      </div>
    {% endif %}
    
  </div>
  
{% endblock %}
